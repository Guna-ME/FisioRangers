-- Create Table: Pessoa
CREATE TABLE [Pessoa] (
  [Cod_Pessoa] int PRIMARY KEY,
  [Nome] char(50),
  [Celular] int(11),
  [Cidade] char(50)
);

-- Create Table: Usuario
CREATE TABLE [Usuario] (
  [Cod_Usuario] int PRIMARY KEY,
  [Tipo] char(50),
  [Nome] char(50),
  [Telefone] int(11)
);

-- Create Table: Sala
CREATE TABLE [Sala] (
  [Cod_Sala] int PRIMARY KEY,
  [Local] char(50),
  [Disposicao] char(1)
);

-- Create Table: Agenda
CREATE TABLE [Agenda] (
  [Cod_agenda] int PRIMARY KEY,
  [Cod_Fisio] int,
  [Cod_Paciente] int,
  [Cod_Usuario] int,
  [Cod_Sala] int,
  [Cod_Servico] int,
  [Horario] datetime,
  [Cancelamento] char(1),
  CONSTRAINT [FK_Paciente] FOREIGN KEY ([Cod_Paciente]) REFERENCES [Pessoa] ([Cod_Pessoa]),
  CONSTRAINT [FK_Usuario] FOREIGN KEY ([Cod_Usuario]) REFERENCES [Usuario] ([Cod_Usuario]),
  CONSTRAINT [FK_Sala] FOREIGN KEY ([Cod_Sala]) REFERENCES [Sala] ([Cod_Sala]),
  CONSTRAINT [FK_Fisio] FOREIGN KEY ([Cod_Fisio]) REFERENCES [Pessoa] ([Cod_Pessoa]),
  CONSTRAINT [FK_Servico] FOREIGN KEY ([Cod_Servico]) REFERENCES [Servico] ([Cod_Servico]),
  CONSTRAINT [FK_Fisio_Agenda] FOREIGN KEY ([Cod_Fisio]) REFERENCES [Servico] ([Cod_Fisio])
);

-- Create Table: Servico
CREATE TABLE [Servico] (
  [Cod_Servico] int PRIMARY KEY,
  [Tipo_Servico] char(50),
  [Valor] float(6.2),
  [Cod_Pagamento] int,
  [Cod_Fisio] int,
  CONSTRAINT [FK_Pagamento] FOREIGN KEY ([Cod_Pagamento]) REFERENCES [Pagamento] ([Cod_Pagamento]),
  CONSTRAINT [FK_Fisio_Servico] FOREIGN KEY ([Cod_Fisio]) REFERENCES [Agenda] ([Cod_Fisio])
);

-- Create Table: Pagamento
CREATE TABLE [Pagamento] (
  [Cod_Pagamento] int PRIMARY KEY,
  [Cod_Tipo] int,
  [Multa_Cancelamento] float(6.2),
  CONSTRAINT [FK_Tipo_Pagamento] FOREIGN KEY ([Cod_Tipo]) REFERENCES [Tipo_Pagamento] ([Cod_Tipo])
);

-- Create Table: Tipo_Pagamento
CREATE TABLE [Tipo_Pagamento] (
  [Cod_Tipo] int PRIMARY KEY,
  [Tipo_Pagamento] char(10)
);

-- Create Table: log
CREATE TABLE [log] (
  [Data] datetime,
  [Nome_Usuario] char(50),
  [Tipo_Operacao] char(50),
  [Descricao] char(100)
);

-- Add Indexes
CREATE CLUSTERED INDEX [IX_Agenda_Horario] ON [Agenda] ([Horario]);
CREATE NONCLUSTERED INDEX [IX_Servico_Cod_Fisio] ON [Servico] ([Cod_Fisio]);
CREATE CLUSTERED INDEX [IX_Pagamento_Cod_Tipo] ON [Pagamento] ([Cod_Tipo]);
CREATE CLUSTERED INDEX [IX_Tipo_Pagamento_Tipo_Pagamento] ON [Tipo_Pagamento] ([Tipo_Pagamento]);
